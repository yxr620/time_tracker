# 时间追踪工具 - 使用手册

## 📱 应用概述

这是一款个人时间追踪工具，帮助你记录日常活动的时间花费，设置和管理每日目标，并统计时间使用情况。

**核心特性：**
- ⏱️ 实时计时追踪
- ✏️ 手动添加历史记录
- 🏷️ 活动分类（6个预设类别）
- 📊 24小时时间轴可视化
- 🎯 每日目标管理
- 📈 **数据分析看板**（桌面端专属）
- 📊 **趋势分析页面**（桌面端专属）
- 🎯 **目标深度分析**（桌面端专属）
- 🔄 多端同步（基于阿里云 OSS，可选）
- 📤 数据导出（JSON格式）
- 📥 数据导入（合并/替换模式）
- 💾 本地离线存储
- 📱 PWA支持（可安装到桌面）
- 💻 桌面端分栏布局
- 🌙 深色模式支持

---

## 🎨 界面布局

**深色模式：** 点击顶部右侧的太阳/月亮图标可切换深色/浅色模式。应用会自动保存你的偏好，下次启动时恢复。

### 移动端布局

应用采用底部三Tab布局：

```
┌─────────────────────────┐
│   时间追踪工具           │
├─────────────────────────┤
│                         │
│    [主要内容区域]        │
│                         │
├─────────────────────────┤
│  📝记录 | 🎯目标 | 📤同步│
└─────────────────────────┘
```

**三个主要Tab页面：**
1. **📝 记录** - 时间追踪和记录管理
2. **🎯 目标** - 每日目标设置和统计
3. **📤 同步** - 数据导出/导入和云同步

### 桌面端布局（屏幕宽度 ≥ 1024px）

桌面端采用侧边栏导航 + 主内容区的分栏布局：

```
┌──────────┬──────────────────────────────┐
│          │                              │
│  📊 分析 │                              │
│  📝 记录 │       [主要内容区域]          │
│  🎯 目标 │                              │
│  📤 同步 │                              │
│          │                              │
│  ⚙️ 设置 │                              │
└──────────┴──────────────────────────────┘
```

**五个主要页面：**
1. **📊 分析** - 数据分析看板（桌面端专属）
   - 点击「类别趋势分析」卡片可进入趋势页面
2. **📝 记录** - 时间追踪和记录管理
3. **🎯 目标** - 每日目标设置和统计
4. **📤 同步** - 数据导出/导入和云同步

---

## 📝 记录页面（第一个Tab）

**日期同步说明**：记录页面、时间轴、目标页面共享同一选中日期。保存记录后保持当前日期不变，方便连续录入。

### 1. 实时计时功能

**开始计时：**
1. 输入活动名称（如："读论文"、"锻炼"）
2. **选择类别**（必选）：学习、工作、运动、娱乐、日常、休息
3. （可选）选择关联的目标
4. 选择开始方式：
   - **接续上次**（主按钮）：从上一个记录的结束时间开始（最常用）
   - **手动添加**：打开手动添加记录弹窗
   - **从现在开始**（底部链接）：立即开始计时

**正在计时时：**
- 显示当前活动名称
- 实时显示已用时间（HH:MM:SS格式）
- 点击"停止"按钮结束计时并保存记录

**关联目标：**
- 在开始计时前，可以选择关联今天的某个目标
- 如果今天没有目标，会显示提示
- 可以选择"无"来不关联目标

### 2. 手动添加记录

**使用场景：** 补充过去的时间记录

**操作步骤：**
1. 点击追踪区域的"手动添加"按钮
2. 在弹窗中填写：
   - **活动名称**（必填）
   - **类别**（必选）：学习、工作、运动、娱乐、日常、休息
   - **关联目标**（可选，从该日期的目标中选择）
   - **开始时间**（点击选择，或使用快捷按钮）
   - **结束时间**（点击选择，或使用快捷按钮）
3. 点击"保存"按钮

**快捷时间按钮：**
- **现在** - 设为当前时间
- **5分钟前** - 当前时间减5分钟
- **15分钟前** - 当前时间减15分钟
- **30分钟前** - 当前时间减30分钟

### 3. 24小时时间轴可视化

**功能说明：**
- 以进度条形式展示一天24小时的时间使用情况
- 可视化显示各个活动的时间分布
- 支持日期切换，查看历史数据

**显示内容：**
- **日期导航**：
  - 左右箭头切换前一天/后一天
  - 当前日期显示（YYYY-MM-DD格式）
  - "今天"快捷按钮（查看历史时显示）
  - 与目标页和录入表单共享日期，切换后跨页面保持
  
- **24小时时间轴**：
  - 横向进度条（0时-24时）
  - 时间刻度标签（0、6、12、18、24）
  - 彩色时间块表示不同活动（按类别颜色）
  - 空白区域表示未记录时间
  
- **当前时间指示**（今天）：
  - 红色竖线标记当前时刻
  - 顶部红点指示当前位置
  
- **统计信息**：
  - 已记录项数
  - 总时长（小时）

**交互操作：**
- **点击时间块**：显示活动详情气泡，同时设置开始时间为该记录结束时间（保持当前日期不变）
  - 活动名称
  - 时间范围（HH:MM - HH:MM）
  - 持续时长
- **点击空白间隙**：自动填充间隙的开始和结束时间（保持当前日期不变）
- **切换日期**：查看不同日期的时间分布，开始时间自动更新为该日期最后记录的结束时间
- **鼠标悬停**（桌面端）：时间块放大显示

**设计特点：**
- 圆角进度条设计，美观现代
- 时间块自动拼接，无缝衔接
- 跨天记录自动裁剪到当天范围
- 颜色与类别系统保持一致

### 4. 记录列表

**显示内容：**
- 按时间倒序显示所有记录
- 每条记录显示：
  - 活动名称
  - 时间范围（HH:MM - HH:MM）
  - 持续时长（X小时Y分钟）
  - 类别标签（灰色实心）
  - 关联的目标（如果有，显示为蓝色边框标签）

**操作记录：**
- **左滑**查看操作按钮
- **编辑**：修改记录的活动名称、时间、关联目标
- **删除**：删除该记录（需要确认）

**编辑记录功能：**
1. 左滑记录，点击"编辑"
2. 可以修改：
   - 活动名称
   - 类别（必选）
   - 关联目标（可添加、更换或移除）
   - 开始时间
   - 结束时间
3. 点击"保存"确认修改

---

## 🎯 目标页面（第二个Tab）

### 1. 日期选择

**切换日期：**
- 点击左右箭头切换到前一天/后一天
- 点击中间的日期区域，打开日期选择器，跳转到任意日期
- 显示"今天"/"昨天"/"明天"或具体日期
- 日期选择与记录页/时间轴保持同步，切换页面后日期不变

**回到今天：**
- 当查看非今天的日期时，会显示"回到今天"按钮
- 点击快速返回今天的目标

### 2. 目标管理

**添加目标：**
1. 点击右上角"添加目标"按钮
2. 输入目标名称（如："读论文"、"锻炼"、"处理工作"）
3. 确认日期（默认为当前选中的日期）
4. 点击"确认添加"

**查看目标：**
- 目标列表显示当天所有目标
- 每个目标显示：
  - 目标名称
  - 已花费时长（实时统计，格式：X小时Y分钟）
  - 花费时长为0分钟也会显示（表示目标已创建但还没开始）

**删除目标：**
- 点击目标右侧的删除按钮
- 确认后删除（注意：已关联该目标的记录不会被删除）

### 3. 统计汇总

**今日总计：**
- 在目标列表上方显示当日所有目标的累计时长
- 格式：X小时Y分钟 / X分钟
- 实时更新

**时长计算规则：**
- 只统计已完成的记录（有结束时间）
- 正在进行的记录不计入统计
- 按目标ID关联计算

---

## 📊 数据分析看板（桌面端专属）

> 💡 该功能仅在桌面端（屏幕宽度 ≥ 1024px）可用，点击侧边栏的「分析」进入。

### 1. 功能概述

数据分析看板提供全面的时间使用可视化分析，帮助你了解时间分配情况和工作习惯。

**主要功能：**
- KPI 指标卡片：快速了解关键数据
- 分类别趋势图：追踪各类别时间投入变化
- 目标分布图：查看时间在各目标上的分配
- 类别分布饼图：直观展示各类别占比
- 时段分布图：分析一天中的工作习惯

### 2. 时间范围选择

在页面右上角可以选择分析的时间范围：
- **最近7天**：查看近一周数据
- **最近30天**：查看近一个月数据（默认）
- **自定义**：自由选择开始和结束日期

### 3. KPI 指标卡片

显示三个关键指标（最常用目标会自动忽略“无目标”）：

| 指标 | 说明 |
|------|------|
| 总时长 | 选定时间范围内的累计记录时长，显示记录条数 |
| 活跃天数 | 有记录的天数，以及平均每天时长 |
| 最常用目标 | 时间投入最多的目标名称（忽略“无目标”） |

### 4. 类别趋势分析入口

**功能说明：**
- 在看板中显示「类别趋势分析」入口卡片
- 点击卡片可进入详细的趋势分析页面
- 卡片预览当前有记录的类别标签

**趋势分析页面功能：**

**1. 总体叠加面积图**
- 展示所有类别时间在日期范围内的分布
- 不同颜色代表不同类别
- 可直观看到每天总时长及各类别占比变化

**2. 周度对比功能**
- 自动计算最近 3 个完整周（周日-周六）的数据
- 包含 3 个可视化组件：

| 图表 | 说明 |
|------|------|
| 类别纵向对比图 | 分组柱状图，每个类别一行，对比 3 周的时长变化 |
| 周度堆叠柱状图 | 每周总时长按类别堆叠显示，直观对比周总量 |
| 本周变化摘要 | 显示本周 vs 上周变化最大的 Top 3 类别，红色/绿色标注增减 |

**3. 单类别趋势折线图**
- 每个类别独立显示一个时长趋势折线图
- 显示当天未记录的时间，计入「未分类」
- 平均值参考线辅助分析
- 支持 7/30 天及自定义日期范围

**显示统计：**
- 每个类别的总计时长
- 每个类别的日均时长

### 5. 目标分布柱状图

**功能说明：**
- 展示时间投入最多的 Top 10 目标
- 横向柱状图，按时长降序排列
- 单位为小时
- “无目标”不绘制柱状图，会在标题旁以徽标标注其时长

**使用场景：**
- 了解哪些目标占用了最多时间
- 评估时间分配是否合理

### 6. 类别分布饼图

**功能说明：**
- 以饼图形式展示各类别的时间占比
- 颜色与应用内预设类别颜色对应
- 显示具体百分比和时长

### 7. 时段分布图

**功能说明：**
- 展示 24 小时内各时段的时间分布
- 柱状图形式，X 轴为 0:00 - 23:00
- 帮助分析一天中的工作习惯和高效时段

**使用场景：**
- 找出最高效的工作时段
- 发现时间使用的规律

### 8. 目标深度分析入口

**功能说明：**
- 在看板中显示「目标深度分析」入口卡片
- 点击可进入详细的目标分析页面
- 提供超越简单 Top 10 分布的深度目标洞察

**目标深度分析页面功能：**

**1. 智能目标聚类**
- 自动将相似目标归为同一「簇」（如"开发 app"、"修复 app bug"、"测试 app" 归为一组）
- 基于 Jaccard 相似度算法，支持中英文混合
- 无需手动分组，算法自动识别

**2. 时间投入概览**
- 总投入时长：选定时间范围内关联目标的总时长
- 日均投入：总投入 ÷ 日期范围天数
- 目标覆盖率：有目标关联的时间占比
- 活跃聚类数：有时间记录的聚类数量

**3. 目标时间分布**
- 水平条形排行图展示 Top 10 目标簇的时间占比
- 其余目标簇合并为「其他」
- 每条显示时长和百分比

**4. 未关联事件建议**
- 识别无目标记录中可能与现有目标簇相关的事件
- 提供快速关联入口（开发中）

---

## 📤 导出页面（第三个Tab）

### 0. 多端同步（可选）

**功能说明：**
- 基于阿里云 OSS 的同步功能
- 支持手机和电脑之间同步数据
- 需要配置阿里云 OSS（配置后可在"导出"页面使用同步管理）

**详细说明：**
请查看 [多端同步功能文档](./sync.md)

**快速了解：**
- 配置 OSS 后，在"导出"页面可使用同步功能
- 提供增量同步（推荐）和强制全量同步（数据恢复）
- 在另一台设备上配置相同的 OSS，手动同步后数据保持一致
- 不配置 OSS 不影响其他功能

### 1. 数据导入

**功能说明：**
- 从之前导出的JSON文件中恢复数据
- 支持两种导入策略：合并模式和替换模式
- 适合多设备数据同步和数据恢复

**导入策略：**

**合并模式（推荐）**
- 保留现有数据，导入新数据
- 相同ID的记录会被更新为导入文件中的版本
- 适合场景：
  - 日常多设备数据同步
  - 补充历史数据
  - 合并多个设备的数据

**替换模式**
- ⚠️ 清空所有现有数据（记录和目标）
- 导入文件中的所有数据
- 此操作不可撤销
- 适合场景：
  - 在新设备上首次恢复数据
  - 完全重置应用数据
  - 从备份恢复到某个时间点

**操作步骤：**
1. 点击"📥 导入数据"按钮
2. 选择导入策略：
   - 点击"合并导入"按钮 → 使用合并模式
   - 点击"替换导入"按钮 → 弹出二次确认对话框 → 确认后使用替换模式
3. 在文件选择器中选择之前导出的JSON文件
4. 等待导入完成（会显示进度提示）
5. 查看导入结果报告：
   - 时间记录导入数量
   - 目标导入数量
   - 类别导入数量
   - 跳过的重复数据数量
   - 错误信息（如果有）
6. 页面自动刷新，显示导入后的数据

**支持的文件格式：**
- 本应用导出的全量导出JSON文件
- 本应用导出的增量导出JSON文件
- 必须包含完整的数据结构（entries、goals、categories）

### 2. 全量导出

**功能说明：**
- 导出所有时间记录、目标和类别为JSON格式
- 包含完整的数据结构
- 适合数据备份和程序化处理

**操作步骤：**
1. 点击"📦 全量导出"按钮
2. 文件自动下载或分享
3. 文件名格式：`time-tracker-full-YYYYMMDD-HHmmss.json`

### 3. 增量导出

**功能说明：**
- 只导出自上次同步后的新增或修改的数据
- 减少文件大小
- 适合定期同步

**操作步骤：**
1. 点击"📤 增量导出（推荐）"按钮
2. 文件自动下载或分享
3. 文件名格式：`time-tracker-sync-YYYYMMDD-HHmmss.json`

### 4. JSON数据结构

**导出文件包含：**
```json
{
  "exportTime": "2024-11-04T12:00:00.000Z",
  "exportType": "full",
  "data": {
    "entries": [
      {
        "id": "uuid",
        "activity": "读论文",
        "categoryId": "study",
        "goalId": "goal-uuid",
        "startTime": "2024-11-03T10:00:00.000Z",
        "endTime": "2024-11-03T11:30:00.000Z"
      }
    ],
    "goals": [...],
    "categories": [
      {"id": "study", "name": "学习", "color": "#1677ff"},
      {"id": "work", "name": "工作", "color": "#52c41a"},
      {"id": "exercise", "name": "运动", "color": "#fa8c16"},
      {"id": "entertainment", "name": "娱乐", "color": "#eb2f96"},
      {"id": "daily", "name": "日常", "color": "#13c2c2"},
      {"id": "rest", "name": "休息", "color": "#722ed1"}
    ]
  },
  "metadata": {
    "totalEntries": 100,
    "totalGoals": 10,
    "totalCategories": 6
  }
}
```

### 5. Python数据分析

导出后可以用Python分析：

```python
import pandas as pd
import json

# 读取导出的JSON
with open('time-tracker-full-xxx.json') as f:
    data = json.load(f)

# 创建类别映射
categories = {c['id']: c['name'] for c in data['data']['categories']}

# 分析时间记录
entries = pd.DataFrame(data['data']['entries'])
entries['category_name'] = entries['categoryId'].map(categories)
entries['duration'] = (
    pd.to_datetime(entries['endTime']) - 
    pd.to_datetime(entries['startTime'])
).dt.total_seconds() / 60

# 按类别统计
category_summary = entries.groupby('category_name')['duration'].sum()
print(category_summary)
```

---

## 💡 使用技巧

### 1. 高效记录时间

**推荐工作流：**
```
1. 每天早上在"目标"页面设置今日目标
2. 开始工作时，在"记录"页面开始计时：
   - 输入活动名称
   - 选择类别（必选）
   - 选择对应目标
   - 点击"接续上次"开始（最常用）
3. 完成一项活动后，停止计时
4. 继续下一项活动，重复步骤2（活动自动接续）
5. 随时查看24小时时间轴，直观了解时间分布
6. 晚上查看"目标"页面的统计结果
7. 每周导出一次数据进行备份和分析
```

### 2. 补充历史记录

**适用情况：**
- 忘记开始计时
- 回顾过去的时间使用
- 批量添加一天的记录

**操作建议：**
- 使用快捷时间按钮快速设置时间
- 先创建当天的目标，再添加记录并关联
- 按时间顺序从早到晚添加

**界面优化说明：**
- "手动添加"按钮已集成到追踪区域，更加紧凑
- 主按钮"接续上次"突出显示，符合最常用的使用习惯
- "从现在开始"作为辅助功能，以链接形式显示在底部

### 3. 目标管理建议

**设置目标的最佳实践：**
- 目标名称简洁明确（2-5个字）
- 不要设置太多目标（建议3-5个）
- 可以为"其他"或"杂项"设置一个目标
- 每天复查和调整目标

**目标不设置时长的优势：**
- 灵活性高，不受限制
- 专注于实际时间花费
- 避免目标压力
- 更符合实际工作场景

### 4. 数据管理

**定期备份：**
- 建议每周使用"增量导出"备份一次数据
- 重要时刻使用"全量导出"创建完整备份
- JSON格式保留完整信息，便于程序化分析
- 将导出文件保存到云盘（如iCloud、Google Drive）

**多设备同步：**
- 在设备A上使用"增量导出"（首次用"全量导出"）
- 将导出的JSON文件传输到设备B
- 在设备B上使用"合并模式"导入
- 避免数据冲突：建议在同步前先备份当前数据

**数据恢复：**
- 新设备首次使用：使用"替换模式"导入全量备份
- 补充数据：使用"合并模式"导入
- 误删除恢复：从最近的备份文件中导入

**数据清理：**
- 通过左滑删除错误记录
- 编辑功能修正不准确的时间
- 删除目标不会影响已有记录
- 重置所有数据：使用"替换模式"导入空文件（不推荐）

---

## 🔧 技术特性

### 本地存储
- 使用IndexedDB存储数据
- 容量大（几百MB到几GB）
- 支持离线使用
- 数据永久保存在设备上

### PWA支持
- 可以安装到手机桌面
- 离线可用
- 类似原生应用体验
- 自动更新

### 键盘适配
- 输入时自动隐藏底部Tab栏
- 避免键盘遮挡内容
- 支持Android和iOS

---

## 📋 数据说明

### 数据结构

**TimeEntry（时间记录）：**
```typescript
{
  id: string;              // 唯一标识
  activity: string;        // 活动名称
  categoryId: string;      // 类别ID（必填）
  startTime: Date;         // 开始时间
  endTime: Date | null;    // 结束时间（进行中时为null）
  goalId: string | null;   // 关联的目标ID（可选）
  createdAt: Date;         // 创建时间
  updatedAt: Date;         // 更新时间
}
```

**Goal（目标）：**
```typescript
{
  id: string;        // 唯一标识
  name: string;      // 目标名称
  date: string;      // 日期（YYYY-MM-DD）
  color: string;     // 颜色标识
  createdAt: Date;   // 创建时间
  updatedAt: Date;   // 更新时间
}
```

### 数据关系
- 记录通过`goalId`关联目标
- 一个目标可以有多条记录
- 删除目标不会删除记录（goalId保留）
- 记录的目标必须与记录日期匹配

---

## ⚠️ 注意事项

### 使用限制
1. **进行中的记录**：同一时间只能有一个正在进行的记录
2. **时间验证**：结束时间必须晚于开始时间
3. **类别必选**：每条记录必须选择一个类别
4. **目标匹配**：只能选择与记录日期相同的目标
5. **活动名称**：不能为空

### 数据安全
- 数据存储在本地设备，不会上传到服务器
- 卸载应用会清除所有数据
- **重要**：定期导出数据进行备份

### 浏览器兼容性
- 推荐使用Chrome、Safari、Edge等现代浏览器
- 需要支持IndexedDB
- Android可以打包为原生应用

---

## 🚀 快速上手

### 5分钟入门
1. 打开应用，进入"目标"页面
2. 添加今天的第一个目标："学习"
3. 回到"记录"页面
4. 输入活动"读书"
5. 选择类别"学习"（必选）
6. 选择目标"学习"
7. 点击"从现在开始"
8. 做你的事情...
9. 完成后点击"停止"
10. 查看24小时时间轴上的彩色时间块
11. 查看记录列表中的新记录（有类别和目标标签）
12. 切换到"目标"页面，查看"学习"目标的时长统计

### 第一天完整流程
```
早上9:00
├─ 打开应用
├─ 目标页面：添加"工作"、"学习"、"锻炼"三个目标
├─ 记录页面：开始"晨会"，关联"工作"目标
└─ ...继续一天的活动

晚上10:00
├─ 查看目标页面的统计
├─ 导出页面：导出今日数据
└─ 完成！
```

---

## 📞 常见问题

**Q: 如何快速了解一天的时间分布？**
A: 查看记录页面的24小时时间轴，彩色时间块直观展示各类活动的时间占用情况。

**Q: 时间轴上的空白是什么意思？**
A: 空白区域表示该时段没有记录任何活动。

**Q: 如何查看时间块的详细信息？**
A: 点击时间轴上的彩色时间块，会弹出气泡显示活动名称、时间范围和持续时长。

**Q: 忘记停止计时怎么办？**
A: 左滑记录点击编辑，手动修改结束时间。

**Q: 类别可以自定义吗？**
A: 当前版本提供6个预设类别，暂不支持自定义。未来版本会添加此功能。

**Q: 可以跨天计时吗？**
A: 不建议。建议在23:59停止，第二天00:00重新开始。

**Q: 目标可以重复使用吗？**
A: 目标是按日期的，每天需要重新创建。未来可能支持模板功能。

**Q: 数据存在哪里？**
A: 存储在浏览器的IndexedDB中，每个设备独立。

**Q: 如何在多设备间同步？**
A: 使用导出/导入功能进行手动同步：
1. 在设备A上使用"增量导出"（首次用"全量导出"）
2. 将JSON文件传输到设备B（通过云盘、邮件等）
3. 在设备B上使用"合并模式"导入
4. 继续在设备B上工作后，重复上述流程反向同步

**Q: 删除目标会删除记录吗？**
A: 不会。已关联该目标的记录会保留goalId，但目标信息不再显示。

**Q: 导入数据会覆盖现有记录吗？**
A: 取决于导入策略：
- **合并模式**：保留现有数据，相同ID的记录会被更新
- **替换模式**：清空所有数据后导入新数据

**Q: 导入失败怎么办？**
A: 可能原因和解决方案：
- 确认文件是本应用导出的JSON格式
- 检查文件是否完整（未被截断）
- 查看导入结果对话框中的详细错误信息
- 如果部分数据导入成功，可以继续使用
- 尝试使用"合并模式"代替"替换模式"

**Q: 如何恢复误删除的数据？**
A: 从最近的备份文件中导入：
1. 找到最近的导出文件（建议定期备份）
2. 使用"合并模式"导入（如果只是部分删除）
3. 或使用"替换模式"完全恢复到备份时的状态

---


---

## 📝 版本信息

**当前版本：** v2.3.0

完整更新日志请查看 [CHANGELOG.md](./CHANGELOG.md)。

**未来计划：**
- 🎨 自定义类别
- 🎯 活动模板
- 🧹 数据库清理功能
- 🔐 端到端加密同步
- 📱 通知提醒功能

---

## 💻 开发信息

详细的技术栈和开发指南请查看 [README.md](./README.md)。

---

## 📄 许可证

本项目仅供个人学习和使用。

---

**感谢使用时间追踪工具！**

如有问题或建议，欢迎反馈。
